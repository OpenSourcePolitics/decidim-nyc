"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(n,t,i){return t&&e(n.prototype,t),i&&e(n,i),n}}();!function(e){var n=function(){function e(){var n=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];_classCallCheck(this,e),this.wrapperField=n.wrapperField,this.controllerFieldSelector=n.controllerFieldSelector,this.dependentInputSelector=n.dependentInputSelector,this.controllerSelector=this.wrapperField.find(this.controllerFieldSelector),this._bindEvent(),this._run()}return _createClass(e,[{key:"_run",value:function(){var e=this;this.controllerSelector.each(function(n,t){var i=$(t),o=i.is(":checked");i.parents("div.collection-input").find(e.dependentInputSelector).prop("disabled",!o)})}},{key:"_bindEvent",value:function(){var e=this;this.controllerSelector.on("change",function(){e._run()})}}]),e}();e.Decidim=e.Decidim||{},e.Decidim.createOptionAttachedInputs=function(e){return new n(e)}}(window);_createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(n,t,i){return t&&e(n.prototype,t),i&&e(n,i),n}}();!function(e){var n=function(){function e(){var n=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];_classCallCheck(this,e),this.wrapperField=n.wrapperField,this._bindEvent(),this._order(),this._normalize()}return _createClass(e,[{key:"_order",value:function(){var e=$(this.wrapperField).find(".collection-input").length;$(this.wrapperField).find(".collection-input").each(function(n,t){for(var i=$(t).find("input[name$=\\[position\\]]"),o=i.val()?parseInt(i.val(),10):e,r=$(t).next();r.length>0;){var a=r.find("input[name$=\\[position\\]]");o>(a.val()?parseInt(a.val(),10):e)&&r.insertBefore($(t)),r=r.next()}})}},{key:"_findLastPosition",value:function(){var e=0;return $(this.wrapperField).find(".collection-input").each(function(n,t){var i=$(t).find("input[name$=\\[position\\]]"),o=parseInt(i.val(),10);o>e&&(e=o)}),e}},{key:"_normalize",value:function(){$(this.wrapperField).find(".collection-input .position").each(function(e,n){var t=$(n).parent().find("input[name$=\\[position\\]]");t.val()&&(t.val(e),t.prop("disabled",!1),$(n).html(e+1+". "))})}},{key:"_bindEvent",value:function(){var e=this;$(this.wrapperField).find("input[type=checkbox]").on("change",function(n){var t=$(n.target).parents("label"),i=t.find(".position"),o=t.find("input[name$=\\[position\\]]"),r=e._findLastPosition();n.target.checked?(o.val(r+1),o.prop("disabled",!1),i.html(r+1)):(o.val(""),o.prop("disabled",!0),i.html("")),e._order(),e._normalize()})}}]),e}();e.Decidim=e.Decidim||{},e.Decidim.createAutosortableCheckboxes=function(e){return new n(e)}}(window);_createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(n,t,i){return t&&e(n.prototype,t),i&&e(n,i),n}}();!function(e){var n=function(){function e(){var n=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];_classCallCheck(this,e),this.wrapperField=n.wrapperField,this.type=n.type,this.conditionQuestion=n.conditionQuestion,this.answerOption=n.answerOption,this.mandatory=n.mandatory,this.value=n.value,this.onFulfilled=n.onFulfilled,this.bindEvent()}return _createClass(e,[{key:"bindEvent",value:function(){this.checkCondition(),this.getInputsToListen().on("change",this.checkCondition.bind(this))}},{key:"getInputValue",value:function(){var e=$(".question[data-question-id='"+this.conditionQuestion+"']"),n=e.find("textarea, input[type='text']:not([name$=\\[custom_body\\]])");if(n.length)return n.val();var t=[];return e.find(".radio-button-collection, .check-box-collection").find(".collection-input").each(function(e,n){var i=$(n).find("input[name$=\\[body\\]]");if(i.is(":checked")){var o=$(n).find("input[name$=\\[custom_body\\]]").val(),r=i.val(),a=$(n).find("input[name$=\\[answer_option_id\\]]").val();t.push({id:a,value:r,text:o})}}),t}},{key:"getInputsToListen",value:function(){var e=$(".question[data-question-id='"+this.conditionQuestion+"']"),n=e.find("textarea, input[type='text']:not([name$=\\[custom_body\\]])");return n.length?n:e.find(".collection-input").find("input:not([type='hidden'])")}},{key:"checkAnsweredCondition",value:function(e){return"object"!=typeof e?Boolean(e):Boolean(e.some(function(e){return e.value}))}},{key:"checkNotAnsweredCondition",value:function(e){return!this.checkAnsweredCondition(e)}},{key:"checkEqualCondition",value:function(e){var n=this;return!!e.length&&e.some(function(e){return e.id===n.answerOption.toString()})}},{key:"checkNotEqualCondition",value:function(e){var n=this;return!!e.length&&e.every(function(e){return e.id!==n.answerOption.toString()})}},{key:"checkMatchCondition",value:function(e){var n=new RegExp(this.value,"i");return"object"!=typeof e?Boolean(e.match(n)):e.some(function(e){return e.text?e.text.match(n):e.value.match(n)})}},{key:"checkCondition",value:function(){var e=this.getInputValue(),n=!1;switch(this.type){case"answered":n=this.checkAnsweredCondition(e);break;case"not_answered":n=this.checkNotAnsweredCondition(e);break;case"equal":n=this.checkEqualCondition(e);break;case"not_equal":n=this.checkNotEqualCondition(e);break;case"match":n=this.checkMatchCondition(e);break;default:n=!1}this.onFulfilled(n)}}]),e}(),t=function(){function e(){var n=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];_classCallCheck(this,e),this.wrapperField=n.wrapperField,this.conditions={},this.showCount=0,this.initializeConditions()}return _createClass(e,[{key:"initializeConditions",value:function(){var e=this;this.wrapperField.find(".display-condition").each(function(t,i){var o=$(i),r=o.data("id");e.conditions[r]={},e.conditions[r]=new n({wrapperField:e.wrapperField,type:o.data("type"),conditionQuestion:o.data("condition"),answerOption:o.data("option"),mandatory:o.data("mandatory"),value:o.data("value"),onFulfilled:function(n){e.onFulfilled(r,n)}})})}},{key:"mustShow",value:function(){var e=Object.values(this.conditions),n=e.filter(function(e){return e.mandatory}),t=e.filter(function(e){return!e.mandatory});return n.length?n.every(function(e){return e.fulfilled}):t.some(function(e){return e.fulfilled})}},{key:"onFulfilled",value:function(e,n){this.conditions[e].fulfilled=n,this.mustShow()?this.showQuestion():this.hideQuestion()}},{key:"showQuestion",value:function(){this.wrapperField.fadeIn(),this.wrapperField.find("input, textarea").prop("disabled",null),this.showCount++}},{key:"hideQuestion",value:function(){this.showCount?this.wrapperField.fadeOut():this.wrapperField.hide(),this.wrapperField.find("input, textarea").prop("disabled","disabled")}}]),e}();e.Decidim=e.Decidim||{},e.Decidim.createDisplayConditions=function(e){return new t(e)}}(window);_createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(n,t,i){return t&&e(n.prototype,t),i&&e(n,i),n}}();!function(e){var n=function(){function e(){var n=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];_classCallCheck(this,e),this.wrapperField=n.wrapperField,this.alertElement=n.alertElement,this.controllerFieldSelector=n.controllerFieldSelector,this.controllerCollectionSelector=n.controllerCollectionSelector,this.maxChoices=n.maxChoices,this.controllerSelector=this.wrapperField.find(this.controllerFieldSelector),this._bindEvent(),this._run()}return _createClass(e,[{key:"_run",value:function(){var e=this,n=this.wrapperField.find(this.controllerCollectionSelector),t=!1;n.each(function(n,i){var o=$(i).find(e.controllerFieldSelector).filter(function(e,n){return $(n).is(":checked")});t=t||o.length>e.maxChoices}),t?this.alertElement.show():this.alertElement.hide()}},{key:"_bindEvent",value:function(){var e=this;this.controllerSelector.on("change",function(){e._run()})}}]),e}();e.Decidim=e.Decidim||{},e.Decidim.createMaxChoicesAlertComponent=function(e){return new n(e)}}(window),function(){var e=window.Decidim,n=e.createOptionAttachedInputs,t=e.createAutosortableCheckboxes,i=e.createMaxChoicesAlertComponent,o=e.createDisplayConditions;$(".radio-button-collection, .check-box-collection").each(function(e,t){n({wrapperField:$(t),controllerFieldSelector:"input[type=radio], input[type=checkbox]",dependentInputSelector:"input[type=text], input[type=hidden]"})}),$.unique($(".check-box-collection").parents(".answer")).each(function(e,n){var t=$(n).data("max-choices");t&&i({wrapperField:$(n),controllerFieldSelector:"input[type=checkbox]",controllerCollectionSelector:".check-box-collection",alertElement:$(n).find(".max-choices-alert"),maxChoices:t})}),$(".sortable-check-box-collection").each(function(e,n){t({wrapperField:$(n)})}),$(".answer-questionnaire .question[data-conditioned='true']").each(function(e,n){o({wrapperField:$(n)})});var r=$("form.answer-questionnaire");r.length>0&&function(){r.find("input, textarea, select").on("change",function(){r.data("changed",!0)});var e=r.data("safe-path").split("?")[0];$(document).on("click","a",function(e){window.exitUrl=e.currentTarget.href}),$(document).on("submit","form",function(e){window.exitUrl=e.currentTarget.action}),window.addEventListener("beforeunload",function(n){var t=window.exitUrl,i=r.data("changed");window.exitUrl=null,!i||t&&t.includes(e)||(n.returnValue=!0)})}()}();