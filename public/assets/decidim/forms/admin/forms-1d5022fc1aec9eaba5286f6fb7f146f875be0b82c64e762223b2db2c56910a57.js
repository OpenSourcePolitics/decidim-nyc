"use strict";function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(n,t,i){return t&&e(n.prototype,t),i&&e(n,i),n}}();!function(e){var n=function(){function e(){var n=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];_classCallCheck(this,e),this.listSelector=n.listSelector,this.minItems=n.minItems,this.hideOnMinItemsOrLessSelector=n.hideOnMinItemsOrLessSelector,this.run()}return _createClass(e,[{key:"run",value:function(){var e=$(this.listSelector),n=e.find(this.hideOnMinItemsOrLessSelector);e.length<=this.minItems?n.hide():n.show()}}]),e}();e.DecidimAdmin=e.DecidimAdmin||{},e.DecidimAdmin.AutoButtonsByMinItemsComponent=n}(window);_createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(n,t,i){return t&&e(n.prototype,t),i&&e(n,i),n}}();!function(e){var n=function(){function e(){var n=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];_classCallCheck(this,e),this.wrapperSelector=n.wrapperSelector,this.selectSelector=n.selectSelector,this.listSelector=n.listSelector}return _createClass(e,[{key:"run",value:function(){var e=$(this.listSelector),n=e.parents(this.wrapperSelector).find(this.selectSelector);n.find("option").slice(1).remove();for(var t=2;t<=e.length;t+=1)$('<option value="'+t+'">'+t+"</option>").appendTo(n)}}]),e}();e.DecidimAdmin=e.DecidimAdmin||{},e.DecidimAdmin.AutoSelectOptionsByTotalItemsComponent=n}(window);_createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(n,t,i){return t&&e(n.prototype,t),i&&e(n,i),n}}();!function(e){var n=function(){function e(){var n=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];_classCallCheck(this,e),this.$source=n.source,this.$select=n.select,this.sourceToParams=n.sourceToParams,this.run()}return _createClass(e,[{key:"run",value:function(){this.$source.on("change",this._onSourceChange.bind(this)),this._onSourceChange()}},{key:"_onSourceChange",value:function(){var e=this.$select,n=this.sourceToParams(this.$source),t=this.$source.data("url");$.getJSON(t,n,function(n){e.find("option:not([value=''])").remove();var t=e.data("selected");n.forEach(function(n){var i=$('<option value="'+n.id+'">'+n.body+"</option>").appendTo(e);n.id===t&&i.attr("selected",!0)}),t&&e.val(t)})}}]),e}();e.DecidimAdmin=e.DecidimAdmin||{},e.DecidimAdmin.AutoSelectOptionsFromUrl=n}(window);_createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(n,t,i){return t&&e(n.prototype,t),i&&e(n,i),n}}();!function(e){var n=function(){function e(){var n=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];_classCallCheck(this,e),this.inputSelector=n.inputSelector,this.targetSelector=n.targetSelector,this.maxLength=n.maxLength,this.omission=n.omission,this.placeholder=n.placeholder,this._bindEvent(),this._run()}return _createClass(e,[{key:"_run",value:function(){var e=$(this.inputSelector),n=$(this.targetSelector),t=e.val()||this.placeholder;t.length>this.maxLength&&(t=t.substring(0,this.maxLength-this.omission.length)+this.omission),n.text(t)}},{key:"_bindEvent",value:function(){$(this.inputSelector).on("change",this._run.bind(this))}}]),e}();e.DecidimAdmin=e.DecidimAdmin||{},e.DecidimAdmin.LiveTextUpdateComponent=n,e.DecidimAdmin.createLiveTextUpdateComponent=function(e){return new n(e)}}(window),function(e){var n=e.DecidimAdmin,t=n.AutoLabelByPositionComponent,i=n.AutoButtonsByPositionComponent,o=n.AutoButtonsByMinItemsComponent,r=n.AutoSelectOptionsByTotalItemsComponent,a=n.AutoSelectOptionsFromUrl,l=n.createLiveTextUpdateComponent,c=n.createFieldDependentInputs,s=n.createDynamicFields,d=n.createSortList,u=e.Decidim.createQuillEditor,p=".questionnaire-questions",f=".questionnaire-question",m="select[name$=\\[question_type\\]]",h=".questionnaire-question-answer-option",v=".questionnaire-question-answer-options",S=".remove-answer-option",w=".questionnaire-question-matrix-row",q=".questionnaire-question-matrix-rows",_=".remove-matrix-row",g=".add-matrix-row",C=".questionnaire-question-max-choices",y=".questionnaire-question-display-condition",b=".questionnaire-question-display-conditions",F=".remove-display-condition",x="select[name$=\\[decidim_condition_question_id\\]]",A="select[name$=\\[decidim_answer_option_id\\]]",O="select[name$=\\[condition_type\\]]",I="input[name$=\\[deleted\\]]",B=".questionnaire-question-display-condition-value",D=".questionnaire-question-display-condition-answer-option",T=".add-display-condition",k=function(){$(f).each(function(e,n){var t=$(n);e?(t.find(b).find(I).val("false"),t.find(b).show()):(t.find(b).find(I).val("true"),t.find(b).hide())})},L=new i({listSelector:".questionnaire-question:not(.hidden)",hideOnFirstSelector:".move-up-question",hideOnLastSelector:".move-down-question"}),P=new t({listSelector:".questionnaire-question:not(.hidden)",labelSelector:".card-title span:first",onPositionComputed:function(e,n){$(e).find("input[name$=\\[position\\]]:not([name*=\\[matrix_rows\\]])").val(n),L.run(),k()}}),E=["single_option","multiple_option","sorting","matrix_single","matrix_multiple"],M=["matrix_single","matrix_multiple"],U=function(e){return new r({wrapperSelector:f,selectSelector:C+" select",listSelector:"#"+e+" "+v+" .questionnaire-question-answer-option:not(.hidden)"})},j=function(e){return new o({wrapperSelector:f,listSelector:"#"+e+" "+v+" .questionnaire-question-answer-option:not(.hidden)",minItems:2,hideOnMinItemsOrLessSelector:S})},R=function(e){return new a({source:e.find(x),select:e.find(A),sourceToParams:function(e){return{id:e.val()}}})},z=function(){d(".questionnaire-questions-list:not(.published)",{handle:".question-divider",placeholder:'<div style="border-style: dashed; border-color: #000"></div>',forcePlaceholderSize:!0,onSortUpdate:function(){P.run(),L.run()}})},J=function(e){var n="#"+e+" .question-title-statement",t=$(n).data("locale"),i=$(n).data("max-length"),o=$(n).data("omission"),r=$(n).data("placeholder");return l({inputSelector:"#"+e+" input[name$=\\[body_"+t+"\\]]",targetSelector:n,maxLength:i,omission:o,placeholder:r})},N=function(e){var n=e.find(".collapsible");if(n.length>0){var t=n.attr("id").replace("-question-card",""),i=t+"-question-card button--collapse-question-"+t+" button--expand-question-"+t;e.find(".question--collapse").data("toggle",i)}},Q=function(e){var n=j(e),t=U(e);return s({placeholderId:"questionnaire-question-answer-option-id",wrapperSelector:"#"+e+" "+v,containerSelector:".questionnaire-question-answer-options-list",fieldSelector:h,addFieldButtonSelector:".add-answer-option",fieldTemplateSelector:".decidim-answer-option-template",removeFieldButtonSelector:S,onAddField:function(){n.run(),t.run()},onRemoveField:function(){n.run(),t.run()}})},G={},H=function(e){return s({placeholderId:"questionnaire-question-matrix-row-id",wrapperSelector:"#"+e+" "+q,containerSelector:".questionnaire-question-matrix-rows-list",fieldSelector:w,addFieldButtonSelector:g,fieldTemplateSelector:".decidim-matrix-row-template",removeFieldButtonSelector:_,onAddField:function(){},onRemoveField:function(){}})},K={},V=function(e){return E.indexOf(e)>=0},W=function(e){return M.indexOf(e)>=0},X=function(e){var n=e.options[e.selectedIndex];return $(n).data("type")},Y=function(e){var n=e.find(x),t=X(n[0]),i=V(t),o=["answered","not_answered"];i&&(o.push("equal"),o.push("not_equal")),o.push("match");var r=e.find(O);r.find("option").each(function(e,n){var t=$(n),i=t.val();i&&(t.show(),o.indexOf(i)<0&&t.hide())}),o.indexOf(r.val())<0&&r.val(o[0]),r.trigger("change")},Z=function(e){var n=e.find(O).val(),t=e.find(B),i=e.find(D),o=e.find(x),r=X(o[0]),a=V(r);"match"===n?t.show():t.hide(),!a||"not_equal"!==n&&"equal"!==n?i.hide():i.show()},ee=function(e){R(e).run(),e.find(x).on("change",function(){Y(e)}),e.find(O).on("change",function(){Z(e)}),Z(e),Y(e)},ne=function(e){return s({placeholderId:"questionnaire-question-display-condition-id",wrapperSelector:"#"+e+" "+b,containerSelector:".questionnaire-question-display-conditions-list",fieldSelector:y,addFieldButtonSelector:T,removeFieldButtonSelector:F,onAddField:function(e){ee(e)},onRemoveField:function(){}})},te={},ie=function(e){var n=e.attr("id"),t=e.find(m);N(e),J(n),c({controllerField:t,wrapperSelector:f,dependentFieldsSelector:v,dependentInputSelector:h+" input",enablingCondition:function(e){return V(e.val())}}),c({controllerField:t,wrapperSelector:f,dependentFieldsSelector:C,dependentInputSelector:"select",enablingCondition:function(e){return"multiple_option"===e.val()||"matrix_multiple"===e.val()}}),c({controllerField:t,wrapperSelector:f,dependentFieldsSelector:q,dependentInputSelector:w+" input",enablingCondition:function(e){return W(e.val())}}),G[n]=Q(n),K[n]=H(n),te[n]=ne(n);var i=G[n],o=K[n],r=function(){V(t.val())&&(0===t.parents(f).find(h).length&&(i._addField(),i._addField()));W(t.val())&&(0===t.parents(f).find(w).length&&(o._addField(),o._addField()))};t.on("change",r),r()},oe=function(e){"true"===e.find("input[name$=\\[deleted\\]]").val()&&(e.addClass("hidden"),e.hide())};s({placeholderId:"questionnaire-question-id",wrapperSelector:p,containerSelector:".questionnaire-questions-list",fieldSelector:f,addFieldButtonSelector:".add-question",addSeparatorButtonSelector:".add-separator",fieldTemplateSelector:".decidim-question-template",separatorTemplateSelector:".decidim-separator-template",removeFieldButtonSelector:".remove-question",moveUpFieldButtonSelector:".move-up-question",moveDownFieldButtonSelector:".move-down-question",onAddField:function(e){ie(e),z(),e.find(".editor-container").each(function(e,n){u(n)}),P.run(),L.run()},onRemoveField:function(e){P.run(),L.run(),e.find(S).each(function(n,t){G[e.attr("id")]._removeField(t)}),e.find(_).each(function(n,t){K[e.attr("id")]._removeField(t)}),e.find(F).each(function(n,t){te[e.attr("id")]._removeField(t)})},onMoveUpField:function(){P.run(),L.run()},onMoveDownField:function(){P.run(),L.run()}}),z(),$(f).each(function(e,n){var t=$(n);oe(t),ie(t)}),$(y).each(function(e,n){var t=$(n);ee(t)}),P.run(),L.run()}(window);